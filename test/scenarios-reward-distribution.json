{
	"Borrow: Supply OMG and borrow Ether to get ALK rewards": [
		["AddToken", "Ether"],
		["SetAssetValue", "Ether", "1.0"],
		["AddSupportedAssetToRewardControl", "Ether"],
		["SetInterestRate", "Ether", ["FixedRate", 0.5, 0.75]],
		["Approve", "Geoff", "Ether", "10.0e18"],
		["Faucet", "Geoff", "Ether", "10.0e18"],
		["Supply", "Geoff", "Ether", "10.0e18"],
		["Assert", ["Success"]],
		["FastForwardWithRewardControl", 1, "blocks"],
		["AddToken", "OMG"],
		["AddCash", "OMG", "1e20"],
		["SetAssetValue", "OMG", "1.0"],
		["AddSupportedAssetToRewardControl", "OMG"],
		["SetInterestRate", "OMG", ["FixedRate", 0.5, 0.75]],
		["Approve", "Torrey", "OMG", "5.0e18"],
		["Faucet", "Torrey", "OMG", "5.0e18"],
		["Supply", "Torrey", "OMG", "2.5e18"],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Supply", "Torrey", "OMG", "2.5e18"],
		["Borrow", "Geoff", "Ether", "2.0e18"],
		["Assert", ["Success"]],
        ["Assert", ["Equal", ["BalanceSheetSupply", "OMG"], ["Exactly", "6.250000000000000000e18"]]],
      	[
			"Assert",
			["Equal", ["SupplyBalance", "Torrey", "OMG"], ["Exactly", "6.250000000000000000e18"]]
		],
      	[
			"Assert",
			["Equal", ["AlkSpeed", "OMG"], ["Exactly", "0.990931e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplyIndex", "OMG"], ["Exactly", "1.752383242105263e35"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplyIndexBlock", "OMG"], ["Exactly", "1002"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplierIndex", "OMG", "Torrey"], ["Exactly", "1.752383242105263e35"]]
		],
        [
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Torrey", "ALK"], ["Exactly", "0"]]
		],
        ["FastForwardWithRewardControl", 1, "blocks"],
		["ClaimAlk", "Torrey"],
		["Assert", ["Success"]],
        ["Assert", ["Equal", ["BalanceSheetSupply", "OMG"], ["Exactly", "6.250000000000000000e18"]]],
      	[
			"Assert",
			["Equal", ["SupplyBalance", "Torrey", "OMG"], ["Exactly", "9.375000000000000000e18"]]
		],
        [
			"Assert",
			["Equal", ["BorrowBalance", "Torrey", "OMG"], ["Exactly", "0"]]
		],
        [
			"Assert",
			["Equal", ["AlkSpeed", "OMG"], ["Exactly", "0.990931e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplyIndex", "OMG"], ["Exactly", "2.8093763087719298e35"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplyIndexBlock", "OMG"], ["Exactly", "1003"]]
		],
      	[
			"Assert",
			["Equal", ["AlkSupplierIndex", "OMG", "Torrey"], ["Exactly", "2.8093763087719298e35"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Torrey", "ALK"], ["Exactly", "0.990931e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkBorrowIndex", "Ether"], ["Exactly", "9.059940571428571e35"]]
		],
      	[
			"Assert",
			["Equal", ["AlkBorrowerIndex", "Ether", "Torrey"], ["Exactly", "9.059940571428571e35"]]
		],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Borrow", "Torrey", "Ether", "2.5e18"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["AlkBorrowerIndex", "Ether", "Torrey"], ["Exactly", "1.4609154171428573e36"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "0"]]
		],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Borrow", "Torrey", "Ether", "2.5e18"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["TokenBalance", "Torrey", "Ether"], ["Exactly", "5e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSpeed", "Ether"], ["Exactly", "2.4728232681818184e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkBorrowIndex", "Ether"], ["Exactly", "1.774924721038961e36"]]
		],
		[
			"Assert",
			["Equal", ["AlkBorrowIndexBlock", "Ether"], ["Exactly", "1005"]]
		],
      	[
			"Assert",
			["Equal", ["AlkBorrowerIndex", "Ether", "Torrey"], ["Exactly", "1.774924721038961e36"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "1.3737907045454546e18"]]
		],
		["ClaimAlk", "Torrey"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Torrey", "ALK"], ["Exactly", "5.742895568181818e18"]]
		]
	],
	"Withdraw: Withdraw should refresh supply index": [
		["AddToken", "Ether"],
		["SetAssetValue", "Ether", "1.0"],
		["AddSupportedAssetToRewardControl", "Ether"],
		["SetInterestRate", "Ether", ["FixedRate", 0.5, 0.75]],
		["Approve", "Geoff", "Ether", "1.0e18"],
		["Faucet", "Geoff", "Ether", "1.0e18"],
		["Supply", "Geoff", "Ether", "1.0e18"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["SupplyBalance", "Geoff", "Ether"], ["Exactly", "1.0e18"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Geoff", "Ether"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplyIndex", "Ether"], ["Exactly", "0"]]
		],
      	["Approve", "Torrey", "Ether", "2.0e18"],
		["Faucet", "Torrey", "Ether", "2.0e18"],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Supply", "Torrey", "Ether", "1.0e18"],
		["Assert", ["Success"]],
		["Assert", ["Equal", ["BalanceSheetSupply", "Ether"], ["Exactly", "2.0e18"]]],
		[
			"Assert",
			["Equal", ["SupplyBalance", "Torrey", "Ether"], ["Exactly", "1.0e18"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Torrey", "Ether"], ["Exactly", "1.0e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplyIndex", "Ether"], ["Exactly", "2.7746068e36"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplierIndex", "Ether", "Torrey"], ["Exactly", "2.7746068e36"]]
		],
      	[
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "0"]]
		],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Assert", ["Equal", ["BalanceSheetSupply", "Ether"], ["Exactly", "2.0e18"]]],
		[
			"Assert",
			["Equal", ["SupplyBalance", "Torrey", "Ether"], ["Exactly", "1.5e18"]]
		],
        ["Withdraw", "Torrey", "Ether", "1.0e18"],
		[
			"Assert",
			["Equal", ["SupplyBalance", "Torrey", "Ether"], ["Exactly", "0.5e18"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Torrey", "Ether"], ["Exactly", "2.0e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplyIndex", "Ether"], ["Exactly", "4.1619102e36"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplierIndex", "Ether", "Torrey"], ["Exactly", "4.1619102e36"]]
		],
        [
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "2.0809551e18"]]
		]
    ],
	"PayBorrow: Supply Ether and Borrow OMG and Repay half should refresh borrow index": [
		["AddToken", "Ether"],
		["SetAssetValue", "Ether", "1.0"],
		["AddSupportedAssetToRewardControl", "Ether"],
		["SetInterestRate", "Ether", ["FixedRate", 0.5, 0.75]],
		["Approve", "Geoff", "Ether", "10.0e18"],
		["Faucet", "Geoff", "Ether", "10.0e18"],
		["Supply", "Geoff", "Ether", "10.0e18"],
		["Assert", ["Success"]],
		["Assert", ["Log", "SupplyReceived"]],
		[
			"Assert",
			["Equal", ["SupplyBalance", "Geoff", "Ether"], ["Exactly", "10.0e18"]]
		],
		["FastForwardWithRewardControl", 2, "blocks"],
		["AddToken", "OMG"],
		["AddCash", "OMG", "1e20"],
		["SetAssetValue", "OMG", "1.0"],
		["AddSupportedAssetToRewardControl", "OMG"],
		["SetInterestRate", "OMG", ["FixedRate", 0.5, 0.75]],
		["Approve", "Torrey", "OMG", "20.0e18"],
		["Faucet", "Torrey", "OMG", "20.0e18"],
		["Supply", "Torrey", "OMG", "20.0e18"],
		[
			"Assert",
			["Equal", ["BalanceSheetBorrow", "OMG"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["AlkSpeed", "OMG"], ["Exactly", "0"]]
		],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Borrow", "Torrey", "OMG", "1.0e18"],
		[
			"Assert",
			["Equal", ["BalanceSheetBorrow", "OMG"], ["Exactly", "1.0e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSpeed", "OMG"], ["Exactly", "2.2701328363636365e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkBorrowIndex", "OMG"], ["Exactly", "0"]]
		],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Borrow", "Geoff", "OMG", "2.0e18"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["BorrowBalance", "Geoff", "OMG"], ["Exactly", "2.0e18"]]
		],
		["FastForwardWithRewardControl", 2, "blocks"],
		[
			"Assert",
			["Equal", ["BorrowBalance", "Geoff", "OMG"], ["Exactly", "5.0e18"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Geoff", "OMG"], ["Precisely", "2.0e18"]]
		],
		[
			"Assert",
			["Equal", ["BalanceSheetBorrow", "OMG"], ["Exactly", "3.0e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSpeed", "OMG"], ["Exactly", "2.1399295360323886e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkBorrowIndex", "OMG"], ["Exactly", "1.2228168777327935e36"]]
		],
      	[
			"Assert",
			["Equal", ["AlkBorrowerIndex", "OMG", "Geoff"], ["Exactly", "1.2228168777327935e36"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Geoff"], ["Exactly", "0"]]
		],
		["Approve", "Geoff", "OMG", "1.0e18"],
		["PayBorrow", "Geoff", "OMG", "1.0e18"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["BorrowBalance", "Geoff", "OMG"], ["Exactly", "4.0e18"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Geoff", "OMG"], ["Exactly", "1.0e18"]]
		],
		[
			"Assert",
			["Equal", ["BalanceSheetBorrow", "OMG"], ["Exactly", "5.0e18"]]
		],
		["FastForwardWithRewardControl", 2, "blocks"],
		[
			"Assert",
			["Equal", ["BorrowBalance", "Geoff", "OMG"], ["Exactly", "10.0e18"]]
		],
		[
			"Assert",
			["Equal", ["BalanceSheetBorrow", "OMG"], ["Exactly", "5.0e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkBorrowIndex", "OMG"], ["Exactly", "1.8253029257327937e36"]]
		],
      	[
			"Assert",
			["Equal", ["AlkBorrowerIndex", "OMG", "Geoff"], ["Exactly", "1.8253029257327937e36"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Geoff"], ["Exactly", "3.01243024e18"]]
		]
	],
	"Liquidate: LiquidateBorrow should refresh both supply and borrow indexes": [
		["AddToken", "OMG"],
		["SetAssetValue", "OMG", "1.0"],
		["AddSupportedAssetToRewardControl", "OMG"],
		["SetInterestRate", "OMG", ["FixedRate", 0.1, 0.15]],
		["Approve", "Robert", "OMG", "0.1e18"],
		["Faucet", "Robert", "OMG", "0.1e18"],
		["Supply", "Robert", "OMG", "0.1e18"],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Approve", "Geoff", "OMG", "2.1e18"],
		["Faucet", "Geoff", "OMG", "2.1e18"],
		["Supply", "Geoff", "OMG", "2.1e18"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["SupplyBalance", "Geoff", "OMG"], ["Exactly", "2.1e18"]]
		],
		["AddToken", "Ether"],
		["SetAssetValue", "Ether", "1.0"],
		["AddSupportedAssetToRewardControl", "Ether"],
		["SetInterestRate", "Ether", ["FixedRate", 0.1, 0.15]],
		["Approve", "Torrey", "Ether", "5.0e18"],
		["Faucet", "Torrey", "Ether", "5.0e18"],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Supply", "Torrey", "Ether", "2.0e18"],
		["Assert", ["Equal", ["BalanceSheetSupply", "OMG"], ["Exactly", "2.2e18"]]],
		[
			"Assert",
			["Equal", ["TokenBalance", "Geoff", "Ether"], ["Exactly", "0.0e18"]]
		],
		["Borrow", "Robert", "Ether", "0.05e18"],
		["FastForwardWithRewardControl", 1, "blocks"],
		["Borrow", "Geoff", "Ether", "1e18"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["BalanceSheetBorrow", "Ether"], ["Exactly", "1.05e18"]]
		],
		[
			"Assert",
			["Equal", ["BorrowBalance", "Geoff", "Ether"], ["Exactly", "1.0e18"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Geoff", "Ether"], ["Exactly", "1e18"]]
		],
		[
			"Assert",
			["Equal", ["BalanceSheetSupply", "Ether"], ["Exactly", "2.0e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplierIndex", "OMG", "Geoff"], ["Exactly", "3.7835547272727274e37"]]
		],
		[
			"Assert",
			["Equal", ["AlkBorrowerIndex", "Ether", "Geoff"], ["Exactly", "3.336400479925428e37"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Geoff"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplierIndex", "OMG", "Torrey"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "0"]]
		],
		["FastForwardWithRewardControl", 1, "blocks"],
		["SetAssetValue", "OMG", "0.5"],
		["Liquidate", "Torrey", "Geoff", "Ether", "0.1e18", "OMG"],
		["Assert", ["Success"]],
		[
			"Assert",
			["Equal", ["BalanceSheetBorrow", "Ether"], ["Exactly", "1.1e18"]]
		],
		[
			"Assert",
			["Equal", ["BorrowBalance", "Geoff", "Ether"], ["Exactly", "1.05e18"]]
		],
		[
			"Assert",
			["Equal", ["BorrowBalance", "Torrey", "Ether"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["SupplyBalance", "Geoff", "OMG"], ["Exactly", "2.51e18"]]
		],
		[
			"Assert",
			["Equal", ["SupplyBalance", "Torrey", "OMG"], ["Exactly", "0.22e18"]]
		],
		[
			"Assert",
			["Equal", ["TokenBalance", "Torrey", "OMG"], ["Exactly", "0"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplierIndex", "OMG", "Geoff"], ["Exactly", "3.9827686179787505e37"]]
		],
		[
			"Assert",
			["Equal", ["AlkBorrowerIndex", "Ether", "Geoff"], ["Exactly", "3.5237907718731914e37"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Geoff"], ["Exactly", "7.593527573673714e18"]]
		],
		[
			"Assert",
			["Equal", ["AlkSupplierIndex", "OMG", "Torrey"], ["Exactly", "3.9827686179787505e37"]]
		],
		[
			"Assert",
			["Equal", ["AlkAccrued", "Torrey"], ["Exactly", "0"]]
		]
	]
}











