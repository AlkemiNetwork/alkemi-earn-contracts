<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/AlkemiRateModel.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> AlkemiRateModel.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">22.22% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>28/126</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">10% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">22.05% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>28/127</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.4.24;
&nbsp;
import "./Exponential.sol";
import "./LiquidationChecker.sol";
&nbsp;
contract AlkemiRateModel is Exponential, LiquidationChecker {
&nbsp;
    uint constant blocksPerYear = 2102400;
&nbsp;
    address public owner;
    address public newOwner;
&nbsp;
    string public contractName;
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier onlyOwner() {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == owner, "non-owner")</span>;
        _;
    }
&nbsp;
    enum IRError {
        NO_ERROR,
        FAILED_TO_ADD_CASH_PLUS_BORROWS,
        FAILED_TO_GET_EXP,
        FAILED_TO_MUL_PRODUCT_TIMES_BORROW_RATE
    }
&nbsp;
    event OwnerUpdate(address indexed owner, address indexed newOwner);
    event LiquidatorUpdate(address indexed owner, address indexed newLiquidator, address indexed oldLiquidator);
&nbsp;
    Exp internal SpreadLow;
    Exp internal BreakPointLow;
    Exp internal ReserveLow;
    Exp internal ReserveMid;
    Exp internal SpreadMid;
    Exp internal BreakPointHigh;
    Exp internal ReserveHigh;
    ExpNegative internal SpreadHigh;
&nbsp;
    Exp internal MinRateActual;
    Exp internal HealthyMinURActual;
    Exp internal HealthyMinRateActual;
    Exp internal MaxRateActual;
    Exp internal HealthyMaxURActual;
    Exp internal HealthyMaxRateActual;
&nbsp;
    constructor(string memory _contractName,uint MinRate,uint HealthyMinUR,uint HealthyMinRate,uint HealthyMaxUR,uint HealthyMaxRate,uint MaxRate, address moneyMarket, address liquidator) LiquidationChecker(moneyMarket, liquidator) public {
        // Remember to enter percentage times 100. ex., if it is 2.50%, enter 250
        owner = msg.sender;
        contractName = _contractName;
        Exp memory  temp1;
        Exp memory temp2;
        Exp memory HunderedMantissa;
        Error err;
&nbsp;
        (err,HunderedMantissa) = getExp(100,1);
&nbsp;
        (err,MinRateActual) = getExp(MinRate,100);
        (err,HealthyMinURActual) = getExp(HealthyMinUR,100);
        (err,HealthyMinRateActual) = getExp(HealthyMinRate,100);
        (err,MaxRateActual) = getExp(MaxRate,100);
        (err,HealthyMaxURActual) = getExp(HealthyMaxUR,100);
        (err,HealthyMaxRateActual) = getExp(HealthyMaxRate,100);
&nbsp;
        SpreadLow = MinRateActual;
        BreakPointLow = HealthyMinURActual;
        BreakPointHigh = HealthyMaxURActual;
&nbsp;
        // ReserveLow = (HealthyMinRate-SpreadLow)/BreakPointLow;
        (err,temp1) = subExp(HealthyMinRateActual,SpreadLow);
        (err,ReserveLow) = divExp(temp1,BreakPointLow);
&nbsp;
        // ReserveMid = (HealthyMaxRate-HealthyMinRate)/(HealthyMaxUR-HealthyMinUR);
        (err,temp1) = subExp(HealthyMaxRateActual,HealthyMinRateActual);
        (err,temp2) = subExp(HealthyMaxURActual,HealthyMinURActual);
        (err,ReserveMid) = divExp(temp1,temp2);
&nbsp;
        // SpreadMid = HealthyMinRate - (ReserveMid * BreakPointLow);
        (err,temp1) = mulExp(ReserveMid,BreakPointLow);
        (err,SpreadMid) = subExp(HealthyMinRateActual,temp1);
&nbsp;
        // ReserveHigh = (MaxRate - HealthyMaxRate) / (100 - HealthyMaxUR);
        (err,temp1) = subExp(MaxRateActual,HealthyMaxRateActual);
        (err,temp2) = subExp(HunderedMantissa,HealthyMaxURActual);
        (err,ReserveHigh) = divExp(temp1,temp2);
&nbsp;
        // SpreadHigh = HealthyMaxRate - (ReserveHigh * BreakPointHigh);
        (err,temp2) = mulExp(ReserveHigh,BreakPointHigh);
        (err,SpreadHigh) = subExpNegative(HealthyMaxRateActual,temp2);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function changeRates(string memory _contractName,uint MinRate,uint HealthyMinUR,uint HealthyMinRate,uint HealthyMaxUR,uint HealthyMaxRate,uint MaxRate) public onlyOwner {</span>
        // Remember to enter percentage times 100. ex., if it is 2.50%, enter 250
<span class="cstat-no" title="statement not covered" >        contractName = _contractName</span>;
<span class="cstat-no" title="statement not covered" >        Exp memory  temp1;</span>
<span class="cstat-no" title="statement not covered" >        Exp memory temp2;</span>
<span class="cstat-no" title="statement not covered" >        Exp memory HunderedMantissa;</span>
<span class="cstat-no" title="statement not covered" >        Error err;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        (err,HunderedMantissa) = getExp(100,1)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        (err,MinRateActual) = getExp(MinRate,100)</span>;
<span class="cstat-no" title="statement not covered" >        (err,HealthyMinURActual) = getExp(HealthyMinUR,100)</span>;
<span class="cstat-no" title="statement not covered" >        (err,HealthyMinRateActual) = getExp(HealthyMinRate,100)</span>;
<span class="cstat-no" title="statement not covered" >        (err,MaxRateActual) = getExp(MaxRate,100)</span>;
<span class="cstat-no" title="statement not covered" >        (err,HealthyMaxURActual) = getExp(HealthyMaxUR,100)</span>;
<span class="cstat-no" title="statement not covered" >        (err,HealthyMaxRateActual) = getExp(HealthyMaxRate,100)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        SpreadLow = MinRateActual</span>;
<span class="cstat-no" title="statement not covered" >        BreakPointLow = HealthyMinURActual</span>;
<span class="cstat-no" title="statement not covered" >        BreakPointHigh = HealthyMaxURActual</span>;
&nbsp;
        // ReserveLow = (HealthyMinRate-SpreadLow)/BreakPointLow;
<span class="cstat-no" title="statement not covered" >        (err,temp1) = subExp(HealthyMinRateActual,SpreadLow)</span>;
<span class="cstat-no" title="statement not covered" >        (err,ReserveLow) = divExp(temp1,BreakPointLow)</span>;
&nbsp;
        // ReserveMid = (HealthyMaxRate-HealthyMinRate)/(HealthyMaxUR-HealthyMinUR);
<span class="cstat-no" title="statement not covered" >        (err,temp1) = subExp(HealthyMaxRateActual,HealthyMinRateActual)</span>;
<span class="cstat-no" title="statement not covered" >        (err,temp2) = subExp(HealthyMaxURActual,HealthyMinURActual)</span>;
<span class="cstat-no" title="statement not covered" >        (err,ReserveMid) = divExp(temp1,temp2)</span>;
&nbsp;
        // SpreadMid = HealthyMinRate - (ReserveMid * BreakPointLow);
<span class="cstat-no" title="statement not covered" >        (err,temp1) = mulExp(ReserveMid,BreakPointLow)</span>;
<span class="cstat-no" title="statement not covered" >        (err,SpreadMid) = subExp(HealthyMinRateActual,temp1)</span>;
&nbsp;
        // ReserveHigh = (MaxRate - HealthyMaxRate) / (100 - HealthyMaxUR);
<span class="cstat-no" title="statement not covered" >        (err,temp1) = subExp(MaxRateActual,HealthyMaxRateActual)</span>;
<span class="cstat-no" title="statement not covered" >        (err,temp2) = subExp(HunderedMantissa,HealthyMaxURActual)</span>;
<span class="cstat-no" title="statement not covered" >        (err,ReserveHigh) = divExp(temp1,temp2)</span>;
&nbsp;
        // SpreadHigh = HealthyMaxRate - (ReserveHigh * BreakPointHigh);
<span class="cstat-no" title="statement not covered" >        (err,temp2) = mulExp(ReserveHigh,BreakPointHigh)</span>;
<span class="cstat-no" title="statement not covered" >        (err,SpreadHigh) = subExpNegative(HealthyMaxRateActual,temp2)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function transferOwnership(address newOwner_) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(newOwner_ != owner, "TransferOwnership: the same owner.")</span>;
<span class="cstat-no" title="statement not covered" >        newOwner = newOwner_</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function acceptOwnership() external {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == newOwner, "AcceptOwnership: only new owner do this.")</span>;
<span class="cstat-no" title="statement not covered" >        emit OwnerUpdate(owner, newOwner);</span>
<span class="cstat-no" title="statement not covered" >        owner = newOwner</span>;
<span class="cstat-no" title="statement not covered" >        newOwner = address(0x0)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setLiquidator(address _liquidator) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(_liquidator != address(0), "setLiquidator: liquidator cannot be a zero address")</span>;
<span class="cstat-no" title="statement not covered" >        require(liquidator != _liquidator, "setLiquidator: The old and new addresses cannot be the same")</span>;
<span class="cstat-no" title="statement not covered" >        address oldLiquidator = liquidator;</span>
<span class="cstat-no" title="statement not covered" >        liquidator = _liquidator</span>;
<span class="cstat-no" title="statement not covered" >        emit LiquidatorUpdate(msg.sender, _liquidator, oldLiquidator);</span>
    }
&nbsp;
    /*
     * @dev Calculates the utilization rate (borrows / (cash + borrows)) as an Exp
     */
<span class="fstat-no" title="function not covered" >    function getUtilizationRate(uint cash, uint borrows) pure internal returns (IRError, Exp memory) {</span>
<span class="cstat-no" title="statement not covered" >        if (borrows == 0) {</span>
            // Utilization rate is zero when there's no borrows
<span class="cstat-no" title="statement not covered" >            return (IRError.NO_ERROR, Exp({mantissa: 0}));</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        (Error err0, uint cashPlusBorrows) = add(cash, borrows);</span>
<span class="cstat-no" title="statement not covered" >        if (err0 != Error.NO_ERROR) {</span>
<span class="cstat-no" title="statement not covered" >            return (IRError.FAILED_TO_ADD_CASH_PLUS_BORROWS, Exp({mantissa: 0}));</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        (Error err1, Exp memory utilizationRate) = getExp(borrows, cashPlusBorrows);</span>
<span class="cstat-no" title="statement not covered" >        if (err1 != Error.NO_ERROR) {</span>
<span class="cstat-no" title="statement not covered" >            return (IRError.FAILED_TO_GET_EXP, Exp({mantissa: 0}));</span>
        }
<span class="cstat-no" title="statement not covered" >        (err1,utilizationRate) = mulScalar(utilizationRate,100)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        return (IRError.NO_ERROR, utilizationRate);</span>
    }
&nbsp;
    /*
     * @dev Calculates the utilization and borrow rates for use by get{Supply,Borrow}Rate functions
     */
<span class="fstat-no" title="function not covered" >    function getUtilizationAndAnnualBorrowRate(uint cash, uint borrows) view internal returns (IRError, Exp memory, Exp memory) {</span>
<span class="cstat-no" title="statement not covered" >        (IRError err0, Exp memory utilizationRate) = getUtilizationRate(cash, borrows);</span>
<span class="cstat-no" title="statement not covered" >        if (err0 != IRError.NO_ERROR) {</span>
<span class="cstat-no" title="statement not covered" >            return (err0, Exp({mantissa: 0}), Exp({mantissa: 0}));</span>
        }
&nbsp;
        /**
         *  Borrow Rate
         *  0 &lt; UR &lt; 20% :      SpreadLow + UR * ReserveLow
         *  20% &lt;= UR &lt;= 80% :  SpreadMid + UR * ReserveMid
         *  80% &lt; UR :          SpreadHigh + UR * ReserveHigh
         */
&nbsp;
<span class="cstat-no" title="statement not covered" >        Error err;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint annualBorrowRateScaled;</span>
<span class="cstat-no" title="statement not covered" >        Exp memory tempScaled;</span>
<span class="cstat-no" title="statement not covered" >        Exp memory tempScaled2;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(utilizationRate.mantissa &lt; BreakPointLow.mantissa) {</span>
<span class="cstat-no" title="statement not covered" >            (err, tempScaled) = mulExp(utilizationRate, ReserveLow)</span>;
<span class="cstat-no" title="statement not covered" >            assert(err == Error.NO_ERROR)</span>;
<span class="cstat-no" title="statement not covered" >            (err, tempScaled2) = addExp(tempScaled, SpreadLow)</span>;
<span class="cstat-no" title="statement not covered" >            annualBorrowRateScaled = tempScaled2.mantissa</span>;
<span class="cstat-no" title="statement not covered" >            assert(err == Error.NO_ERROR)</span>;
        }
        else <span class="cstat-no" title="statement not covered" >if (utilizationRate.mantissa &gt; BreakPointHigh.mantissa) {</span>
<span class="cstat-no" title="statement not covered" >            (err, tempScaled) = mulExp(utilizationRate, ReserveHigh)</span>;
<span class="cstat-no" title="statement not covered" >            assert(err == Error.NO_ERROR)</span>;
<span class="cstat-no" title="statement not covered" >            (err, tempScaled2) = addExpNegative(tempScaled, SpreadHigh)</span>;
<span class="cstat-no" title="statement not covered" >            annualBorrowRateScaled = tempScaled2.mantissa</span>;
<span class="cstat-no" title="statement not covered" >            assert(err == Error.NO_ERROR)</span>;
        }
        else <span class="cstat-no" title="statement not covered" >if (utilizationRate.mantissa &gt;= BreakPointLow.mantissa &amp;&amp; utilizationRate.mantissa &lt;= BreakPointHigh.mantissa) {</span>
<span class="cstat-no" title="statement not covered" >            (err, tempScaled) = mulExp(utilizationRate, ReserveMid)</span>;
<span class="cstat-no" title="statement not covered" >            assert(err == Error.NO_ERROR)</span>;
<span class="cstat-no" title="statement not covered" >            (err, tempScaled2) = addExp(tempScaled, SpreadMid)</span>;
<span class="cstat-no" title="statement not covered" >            annualBorrowRateScaled = tempScaled2.mantissa</span>;
<span class="cstat-no" title="statement not covered" >            assert(err == Error.NO_ERROR)</span>;
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return (IRError.NO_ERROR, utilizationRate, Exp({mantissa: annualBorrowRateScaled / 100}));</span>
    }
&nbsp;
    /**
      * @notice Gets the current supply interest rate based on the given asset, total cash and total borrows
      * @dev The return value should be scaled by 1e18, thus a return value of
      *      `(true, 1000000000000)` implies an interest rate of 0.000001 or 0.0001% *per block*.
      * @param _asset The asset to get the interest rate of
      * @param cash The total cash of the asset in the market
      * @param borrows The total borrows of the asset in the market
      * @return Success or failure and the supply interest rate per block scaled by 10e18
      */
<span class="fstat-no" title="function not covered" >    function getSupplyRate(address _asset, uint cash, uint borrows) public view returns (uint, uint) {</span>
        _asset; // pragma ignore unused argument
<span class="cstat-no" title="statement not covered" >        (IRError err0, Exp memory utilizationRate0, Exp memory annualBorrowRate) = getUtilizationAndAnnualBorrowRate(cash, borrows);</span>
<span class="cstat-no" title="statement not covered" >        if (err0 != IRError.NO_ERROR) {</span>
<span class="cstat-no" title="statement not covered" >            return (uint(err0), 0);</span>
        }
&nbsp;
       /**
       *  Supply Rate
       *  = BorrowRate * utilizationRate * (1 - SpreadLow)
       */
<span class="cstat-no" title="statement not covered" >       Exp memory temp1;</span>
<span class="cstat-no" title="statement not covered" >       Error err1;</span>
<span class="cstat-no" title="statement not covered" >       Exp memory oneMinusSpreadBasisPoints;</span>
<span class="cstat-no" title="statement not covered" >       (err1,temp1) = getExp(100,1)</span>;
<span class="cstat-no" title="statement not covered" >       assert(err1 == Error.NO_ERROR)</span>;
<span class="cstat-no" title="statement not covered" >       (err1,oneMinusSpreadBasisPoints) = subExp(temp1,SpreadLow)</span>;
&nbsp;
        // mulScalar only overflows when product is greater than or equal to 2^256.
        // utilization rate's mantissa is a number between [0e18,1e18]. That means that
        // utilizationRate1 is a value between [0e18,8.5e21]. This is strictly less than 2^256.
<span class="cstat-no" title="statement not covered" >        assert(err1 == Error.NO_ERROR)</span>;
&nbsp;
        // Next multiply this product times the borrow rate
<span class="cstat-no" title="statement not covered" >        (err1, temp1) = mulExp(utilizationRate0, annualBorrowRate)</span>;
        // If the product of the mantissas for mulExp are both less than 2^256,
        // then this operation will never fail. TODO: Verify.
        // We know that borrow rate is in the interval [0, 2.25e17] from above.
        // We know that utilizationRate1 is in the interval [0, 9e21] from directly above.
        // As such, the multiplication is in the interval of [0, 2.025e39]. This is strictly
        // less than 2^256 (which is about 10e77).
<span class="cstat-no" title="statement not covered" >        assert(err1 == Error.NO_ERROR)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        (err1, temp1) = mulExp(temp1, oneMinusSpreadBasisPoints)</span>;
<span class="cstat-no" title="statement not covered" >        assert(err1 == Error.NO_ERROR)</span>;
&nbsp;
        // And then divide down by the spread's denominator (basis points divisor)
        // as well as by blocks per year.
<span class="cstat-no" title="statement not covered" >        (Error err4, Exp memory supplyRate) = divScalar(temp1, 10000 * blocksPerYear);</span> // basis points * blocks per year
        // divScalar only fails when divisor is zero. This is clearly not the case.
<span class="cstat-no" title="statement not covered" >        assert(err4 == Error.NO_ERROR)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        return (uint(IRError.NO_ERROR), supplyRate.mantissa);</span>
    }
&nbsp;
    /**
      * @notice Gets the current borrow interest rate based on the given asset, total cash and total borrows
      * @dev The return value should be scaled by 1e18, thus a return value of
      *      `(true, 1000000000000)` implies an interest rate of 0.000001 or 0.0001% *per block*.
      * @param asset The asset to get the interest rate of
      * @param cash The total cash of the asset in the market
      * @param borrows The total borrows of the asset in the market
      * @return Success or failure and the borrow interest rate per block scaled by 10e18
      */
<span class="fstat-no" title="function not covered" >    function getBorrowRate(address asset, uint cash, uint borrows) public view returns (uint, uint) {</span>
        asset; // pragma ignore unused argument
&nbsp;
<span class="cstat-no" title="statement not covered" >        (IRError err0, , Exp memory annualBorrowRate) = getUtilizationAndAnnualBorrowRate(cash, borrows);</span>
<span class="cstat-no" title="statement not covered" >        if (err0 != IRError.NO_ERROR) {</span>
<span class="cstat-no" title="statement not covered" >            return (uint(err0), 0);</span>
        }
&nbsp;
        // And then divide down by blocks per year.
<span class="cstat-no" title="statement not covered" >        (Error err1, Exp memory borrowRate) = divScalar(annualBorrowRate, blocksPerYear);</span> // basis points * blocks per year
        // divScalar only fails when divisor is zero. This is clearly not the case.
<span class="cstat-no" title="statement not covered" >        assert(err1 == Error.NO_ERROR)</span>;
&nbsp;
        // Note: mantissa is the rate scaled 1e18, which matches the expected result
<span class="cstat-no" title="statement not covered" >        return (uint(IRError.NO_ERROR), borrowRate.mantissa);</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Apr 29 2021 19:45:33 GMT-0400 (Eastern Daylight Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
