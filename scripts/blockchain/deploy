#!/usr/bin/env sh

set -eo pipefail

DIR=`dirname $0`
PROJ_ROOT="$DIR/../.."

network="$1"

if [ -z "$network" ]; then
	echo "usage: scripts/blockchain/deploy {network}"
	echo ""
	echo "deploys fresh money market contract to network (note: uses --reset)"
	exit 1
fi

truffle deploy --network="$network" --reset
  "metadata": "{\"compiler\":{\"version\":\"0.4.24+commit.e67f0147\"},\"language\":\"Solidity\",\"output\":{\"abi\":[{\"constant\":true,\"inputs\":[],\"name\":\"supply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"},{\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"allocateTo\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"delegate\",\"type\":\"address\"},{\"name\":\"numTokens\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"owner\",\"type\":\"address\"},{\"name\":\"buyer\",\"type\":\"address\"},{\"name\":\"numTokens\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"balances\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"},{\"name\":\"\",\"type\":\"address\"}],\"name\":\"allowed\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"tokenOwner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"receiver\",\"type\":\"address\"},{\"name\":\"numTokens\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"owner\",\"type\":\"address\"},{\"name\":\"delegate\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"_name\",\"type\":\"string\"},{\"name\":\"_symbol\",\"type\":\"string\"},{\"name\":\"_decimals\",\"type\":\"uint8\"},{\"name\":\"_supply\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"receiver\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"tokens\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"delegate\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"tokens\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"}],\"devdoc\":{\"methods\":{}},\"userdoc\":{\"methods\":{}}},\"settings\":{\"compilationTarget\":{\"/Users/ryanbreen/Workspace/Alkemi/alkemi-earn/alkemi-earn-protocol/contracts/TestTokens.sol\":\"TestTokens\"},\"evmVersion\":\"byzantium\",\"libraries\":{},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[]},\"sources\":{\"/Users/ryanbreen/Workspace/Alkemi/alkemi-earn/alkemi-earn-protocol/contracts/TestTokens.sol\":{\"keccak256\":\"0xb96d2667396c8f6ea8008c31a05ba99ec639eb5fb1f5e6885b0adef228332993\",\"urls\":[\"bzzr://ab49cb8bfbda895da0360e1be8fd7fe02b0c8b1113ebdd67e364cb7c922e208c\"]}},\"version\":1}",
  "bytecode": "0x608060405234801561001057600080fd5b50604051610ac9380380610ac98339810160409081528151602080840151928401516060850151928501805190959490940193909291610055916000918701906100a6565b5082516100699060019060208601906100a6565b506002805460ff191660ff9390931692909217909155670de0b6b3a764000002600381905533600090815260046020526040902055506101419050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100e757805160ff1916838001178555610114565b82800160010185558215610114579182015b828111156101145782518255916020019190600101906100f9565b50610120929150610124565b5090565b61013e91905b80821115610120576000815560010161012a565b90565b610979806101506000396000f3006080604052600436106100c45763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663047fc9aa81146100c957806306fdde03146100f057806308bca5661461017a578063095ea7b3146101a057806318160ddd146101d857806323b872dd146101ed57806327e235e314610217578063313ce567146102385780635c6581651461026357806370a082311461028a57806395d89b41146102ab578063a9059cbb146102c0578063dd62ed3e146102e4575b600080fd5b3480156100d557600080fd5b506100de61030b565b60408051918252519081900360200190f35b3480156100fc57600080fd5b50610105610311565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561013f578181015183820152602001610127565b50505050905090810190601f16801561016c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561018657600080fd5b5061019e600160a060020a036004351660243561039f565b005b3480156101ac57600080fd5b506101c4600160a060020a036004351660243561040a565b604080519115158252519081900360200190f35b3480156101e457600080fd5b506100de610502565b3480156101f957600080fd5b506101c4600160a060020a0360043581169060243516604435610508565b34801561022357600080fd5b506100de600160a060020a036004351661070f565b34801561024457600080fd5b5061024d610721565b6040805160ff9092168252519081900360200190f35b34801561026f57600080fd5b506100de600160a060020a036004358116906024351661072a565b34801561029657600080fd5b506100de600160a060020a0360043516610747565b3480156102b757600080fd5b50610105610762565b3480156102cc57600080fd5b506101c4600160a060020a03600435166024356107bc565b3480156102f057600080fd5b506100de600160a060020a0360043581169060243516610922565b60035481565b6000805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156103975780601f1061036c57610100808354040283529160200191610397565b820191906000526020600020905b81548152906001019060200180831161037a57829003601f168201915b505050505081565b600160a060020a0382166000818152600460209081526040918290208054850190556003805485019055815130815290810192909252818101839052517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360600190a15050565b600033600160a060020a0384161415610493576040805160e560020a62461bcd02815260206004820152602560248201527f53656e64657220616e642064656c65676174652063616e27742062652074686560448201527f2073616d65000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b336000818152600560209081526040808320600160a060020a03881680855290835292819020869055805193845290830191909152818101849052517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259181900360600190a150600192915050565b60035490565b6000600160a060020a038481169084161415610594576040805160e560020a62461bcd02815260206004820152602160248201527f4f776e657220616e642042757965722063616e2774206265207468652073616d60448201527f6500000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b600160a060020a038416600090815260046020526040902054821115610604576040805160e560020a62461bcd02815260206004820152601260248201527f4e6f7420656e6f7567682062616c616e63650000000000000000000000000000604482015290519081900360640190fd5b600160a060020a038416600090815260056020908152604080832033845290915290205482111561067f576040805160e560020a62461bcd02815260206004820152601460248201527f4e6f7420656e6f75676820616c6c6f77616e6365000000000000000000000000604482015290519081900360640190fd5b600160a060020a038085166000818152600460209081526040808320805488900390559387168083528483208054880190558383526005825284832033845282529184902080548790039055835192835282015280820184905290517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360600190a15060019392505050565b60046020526000908152604090205481565b60025460ff1681565b600560209081526000928352604080842090915290825290205481565b600160a060020a031660009081526004602052604090205490565b60018054604080516020600284861615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156103975780601f1061036c57610100808354040283529160200191610397565b600033600160a060020a0384161415610845576040805160e560020a62461bcd02815260206004820152602560248201527f53656e64657220616e642072656365697665722063616e27742062652074686560448201527f2073616d65000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b336000908152600460205260409020548211156108ac576040805160e560020a62461bcd02815260206004820152601260248201527f4e6f7420656e6f7567682062616c616e63650000000000000000000000000000604482015290519081900360640190fd5b33600081815260046020908152604080832080548790039055600160a060020a03871680845292819020805487019055805193845290830191909152818101849052517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360600190a150600192915050565b600160a060020a039182166000908152600560209081526040808320939094168252919091522054905600a165627a7a723058200311086dbecc1b516d52c7f34e62fbdfb30cad60150fe7a2bb617b93cc2c7a060029",
  "deployedBytecode": "0x6080604052600436106100c45763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663047fc9aa81146100c957806306fdde03146100f057806308bca5661461017a578063095ea7b3146101a057806318160ddd146101d857806323b872dd146101ed57806327e235e314610217578063313ce567146102385780635c6581651461026357806370a082311461028a57806395d89b41146102ab578063a9059cbb146102c0578063dd62ed3e146102e4575b600080fd5b3480156100d557600080fd5b506100de61030b565b60408051918252519081900360200190f35b3480156100fc57600080fd5b50610105610311565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561013f578181015183820152602001610127565b50505050905090810190601f16801561016c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561018657600080fd5b5061019e600160a060020a036004351660243561039f565b005b3480156101ac57600080fd5b506101c4600160a060020a036004351660243561040a565b604080519115158252519081900360200190f35b3480156101e457600080fd5b506100de610502565b3480156101f957600080fd5b506101c4600160a060020a0360043581169060243516604435610508565b34801561022357600080fd5b506100de600160a060020a036004351661070f565b34801561024457600080fd5b5061024d610721565b6040805160ff9092168252519081900360200190f35b34801561026f57600080fd5b506100de600160a060020a036004358116906024351661072a565b34801561029657600080fd5b506100de600160a060020a0360043516610747565b3480156102b757600080fd5b50610105610762565b3480156102cc57600080fd5b506101c4600160a060020a03600435166024356107bc565b3480156102f057600080fd5b506100de600160a060020a0360043581169060243516610922565b60035481565b6000805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156103975780601f1061036c57610100808354040283529160200191610397565b820191906000526020600020905b81548152906001019060200180831161037a57829003601f168201915b505050505081565b600160a060020a0382166000818152600460209081526040918290208054850190556003805485019055815130815290810192909252818101839052517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360600190a15050565b600033600160a060020a0384161415610493576040805160e560020a62461bcd02815260206004820152602560248201527f53656e64657220616e642064656c65676174652063616e27742062652074686560448201527f2073616d65000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b336000818152600560209081526040808320600160a060020a03881680855290835292819020869055805193845290830191909152818101849052517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259181900360600190a150600192915050565b60035490565b6000600160a060020a038481169084161415610594576040805160e560020a62461bcd02815260206004820152602160248201527f4f776e657220616e642042757965722063616e2774206265207468652073616d60448201527f6500000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b600160a060020a038416600090815260046020526040902054821115610604576040805160e560020a62461bcd02815260206004820152601260248201527f4e6f7420656e6f7567682062616c616e63650000000000000000000000000000604482015290519081900360640190fd5b600160a060020a038416600090815260056020908152604080832033845290915290205482111561067f576040805160e560020a62461bcd02815260206004820152601460248201527f4e6f7420656e6f75676820616c6c6f77616e6365000000000000000000000000604482015290519081900360640190fd5b600160a060020a038085166000818152600460209081526040808320805488900390559387168083528483208054880190558383526005825284832033845282529184902080548790039055835192835282015280820184905290517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360600190a15060019392505050565b60046020526000908152604090205481565b60025460ff1681565b600560209081526000928352604080842090915290825290205481565b600160a060020a031660009081526004602052604090205490565b60018054604080516020600284861615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156103975780601f1061036c57610100808354040283529160200191610397565b600033600160a060020a0384161415610845576040805160e560020a62461bcd02815260206004820152602560248201527f53656e64657220616e642072656365697665722063616e27742062652074686560448201527f2073616d65000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b336000908152600460205260409020548211156108ac576040805160e560020a62461bcd02815260206004820152601260248201527f4e6f7420656e6f7567682062616c616e63650000000000000000000000000000604482015290519081900360640190fd5b33600081815260046020908152604080832080548790039055600160a060020a03871680845292819020805487019055805193845290830191909152818101849052517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360600190a150600192915050565b600160a060020a039182166000908152600560209081526040808320939094168252919091522054905600a165627a7a723058200311086dbecc1b516d52c7f34e62fbdfb30cad60150fe7a2bb617b93cc2c7a060029",
  "sourceMap": "25:2731:23:-;;;466:243;8:9:-1;5:2;;;30:1;27;20:12;5:2;466:243:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;570:12;;466:243;;;;;;;;;;570:12;;:4;;:12;;;;:::i;:::-;-1:-1:-1;588:16:23;;;;:6;;:16;;;;;:::i;:::-;-1:-1:-1;610:8:23;:20;;-1:-1:-1;;610:20:23;;;;;;;;;;;;;655:6;645:16;636:6;:25;;;676:10;-1:-1:-1;667:20:23;;;:8;:20;;;;;:39;-1:-1:-1;25:2731:23;;-1:-1:-1;25:2731:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;25:2731:23;;;-1:-1:-1;25:2731:23;:::i;:::-;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;",
  "deployedSourceMap": "25:2731:23:-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;184:21;;8:9:-1;5:2;;;30:1;27;20:12;5:2;184:21:23;;;;;;;;;;;;;;;;;;;;59:18;;8:9:-1;5:2;;;30:1;27;20:12;5:2;59:18:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8:100:-1;33:3;30:1;27:10;8:100;;;90:11;;;84:18;71:11;;;64:39;52:2;45:10;8:100;;;12:14;59:18:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2576:178;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;2576:178:23;-1:-1:-1;;;;;2576:178:23;;;;;;;;;1492:268;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;1492:268:23;-1:-1:-1;;;;;1492:268:23;;;;;;;;;;;;;;;;;;;;;;;;;772:76;;8:9:-1;5:2;;;30:1;27;20:12;5:2;772:76:23;;;;2002:472;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;2002:472:23;-1:-1:-1;;;;;2002:472:23;;;;;;;;;;;;208:40;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;208:40:23;-1:-1:-1;;;;;208:40:23;;;;;135:21;;8:9:-1;5:2;;;30:1;27;20:12;5:2;135:21:23;;;;;;;;;;;;;;;;;;;;;;;250:59;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;250:59:23;-1:-1:-1;;;;;250:59:23;;;;;;;;;;891:103;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;891:103:23;-1:-1:-1;;;;;891:103:23;;;;;79:20;;8:9:-1;5:2;;;30:1;27;20:12;5:2;79:20:23;;;;1057:367;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;1057:367:23;-1:-1:-1;;;;;1057:367:23;;;;;;;1824:120;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;1824:120:23;-1:-1:-1;;;;;1824:120:23;;;;;;;;;;184:21;;;;:::o;59:18::-;;;;;;;;;;;;;;;-1:-1:-1;;59:18:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::o;2576:178::-;-1:-1:-1;;;;;2644:16:23;;;;;;:8;:16;;;;;;;;;:25;;;;;;2679:6;:15;;;;;;2709:38;;2726:4;2709:38;;;;;;;;;;;;;;;;;;;;;;;;;2576:178;;:::o;1492:268::-;1561:4;1580:10;-1:-1:-1;;;;;1580:22:23;;;;1572:71;;;;;-1:-1:-1;;;;;1572:71:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;1657:10;1649:19;;;;:7;:19;;;;;;;;-1:-1:-1;;;;;1649:29:23;;;;;;;;;;;;:41;;;1701:39;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;1753:4:23;1492:268;;;;:::o;772:76::-;839:6;;772:76;:::o;2002:472::-;2088:4;-1:-1:-1;;;;;2107:14:23;;;;;;;;2099:59;;;;;-1:-1:-1;;;;;2099:59:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;;;;;2172:15:23;;;;;;:8;:15;;;;;;:28;-1:-1:-1;2172:28:23;2164:58;;;;;-1:-1:-1;;;;;2164:58:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;;;;;2236:14:23;;;;;;:7;:14;;;;;;;;2251:10;2236:26;;;;;;;;:39;-1:-1:-1;2236:39:23;2228:71;;;;;-1:-1:-1;;;;;2228:71:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;;;;;2305:15:23;;;;;;;:8;:15;;;;;;;;:28;;;;;;;2339:15;;;;;;;;;:28;;;;;;2373:14;;;:7;:14;;;;;2388:10;2373:26;;;;;;;;:39;;;;;;;2423:31;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;2467:4:23;2002:472;;;;;:::o;208:40::-;;;;;;;;;;;;;:::o;135:21::-;;;;;;:::o;250:59::-;;;;;;;;;;;;;;;;;;;;;;;;:::o;891:103::-;-1:-1:-1;;;;;971:20:23;953:4;971:20;;;:8;:20;;;;;;;891:103::o;79:20::-;;;;;;;;;;;;;;;-1:-1:-1;;79:20:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;1057:367;1127:4;1146:10;-1:-1:-1;;;;;1146:22:23;;;;1138:71;;;;;-1:-1:-1;;;;;1138:71:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;1232:10;1223:20;;;;:8;:20;;;;;;:33;-1:-1:-1;1223:33:23;1215:63;;;;;-1:-1:-1;;;;;1215:63:23;;;;;;;;;;;;;;;;;;;;;;;;;;;;1293:10;1284:20;;;;:8;:20;;;;;;;;:33;;;;;;;-1:-1:-1;;;;;1323:18:23;;;;;;;;;:31;;;;;;1365:39;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;1417:4:23;1057:367;;;;:::o;1824:120::-;-1:-1:-1;;;;;1917:14:23;;;1899:4;1917:14;;;:7;:14;;;;;;;;:24;;;;;;;;;;;;;1824:120::o",
